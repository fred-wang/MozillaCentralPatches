# HG changeset patch
# Parent f79e6d70bc9080fe8b8c065ffdd53f7024c950eb
# User Frédéric Wang <fred.wang@free.fr>
Reftests for bug 657279. r=karlt.

diff --git a/layout/reftests/mathml/maction-dynamic-embellished-op-ref.html b/layout/reftests/mathml/maction-dynamic-embellished-op-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/mathml/maction-dynamic-embellished-op-ref.html
@@ -0,0 +1,30 @@
+<html>
+
+<head>
+<title>dynamic maction and embellished op</title>
+</head>
+
+<body>
+
+  <p>'<math><maction id="m1" selection="2"><mi>a</mi><mo>b</mo></maction></math>'</p>
+  <p>'<math><maction id="m2" selection="2"><mo>b</mo><mi>a</mi></maction></math>'</p>
+ 
+  <p>"<math><maction id="m3"><mo>b</mo></maction></math>"</p>
+  <p>"<math><maction id="m3bis"><mi>a</mi><mo>b</mo></maction></math>"</p>
+
+  <p>{<math><maction id="m4"><mi>a</mi></maction></math>}</p>
+  <p>{<math><maction id="m4bis"><mo>b</mo><mi>a</mi></maction></math>}</p>
+
+ 
+  <p>[<math>
+    <mstyle id="m5" selection="2"><maction><mi>a</mi><mo>b</mo></maction></mstyle>
+  </math>]</p>
+  <p>[<math>
+    <mstyle id="m6" selection="2"><maction><mo>b</mo><mi>a</mi></maction></mstyle>
+  </math>]</p>
+
+  <p>(<math id="m7" selection="2"><maction><mi>a</mi><mo>b</mo></maction></math>)</p>
+  <p>(<math id="m8" selection="2"><maction><mo>b</mo><mi>a</mi></maction></math>)</p>
+
+</body>
+</html>
diff --git a/layout/reftests/mathml/maction-dynamic-embellished-op.html b/layout/reftests/mathml/maction-dynamic-embellished-op.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/mathml/maction-dynamic-embellished-op.html
@@ -0,0 +1,56 @@
+<html class="reftest-wait">
+
+<head>
+<title>dynamic maction and embellished op</title>
+</head>
+
+<body>
+
+  <p>'<math><maction id="m1"><mi>a</mi><mo>b</mo></maction></math>'</p>
+  <p>'<math><maction id="m2"><mo>b</mo><mi>a</mi></maction></math>'</p>
+ 
+  <p>"<math><maction id="m3"><mi>a</mi><mo>b</mo></maction></math>"</p>
+  <p>"<math><maction id="m3bis"><mo>b</mo></maction></math>"</p>
+
+  <p>{<math><maction id="m4"><mo>b</mo><mi>a</mi></maction></math>}</p>
+  <p>{<math><maction id="m4bis"><mi>a</mi></maction></math>}</p>
+
+ 
+  <p>[<math>
+    <mstyle id="m5"><maction><mi>a</mi><mo>b</mo></maction></mstyle>
+  </math>]</p>
+  <p>[<math>
+    <mstyle id="m6"><maction><mo>b</mo><mi>a</mi></maction></mstyle>
+  </math>]</p>
+
+  <p>(<math id="m7"><maction><mi>a</mi><mo>b</mo></maction></math>)</p>
+  <p>(<math id="m8"><maction><mo>b</mo><mi>a</mi></maction></math>)</p>
+
+<script>
+function doTest()
+{
+  document.getElementById("m1").setAttribute("selection", "2");
+  document.getElementById("m2").setAttribute("selection", "2");
+
+  var m3 = document.getElementById("m3");
+  var m3bis = document.getElementById("m3bis");
+  m3bis.insertBefore(m3.removeChild(m3.firstChild), m3bis.firstChild);
+
+  var m4 = document.getElementById("m4");
+  var m4bis = document.getElementById("m4bis");
+  m4bis.insertBefore(m4.removeChild(m4.firstChild), m4bis.firstChild);
+
+  document.getElementById("m5").setAttribute("selection", "2");
+  document.getElementById("m6").setAttribute("selection", "2");
+
+  document.getElementById("m7").setAttribute("selection", "2");
+  document.getElementById("m8").setAttribute("selection", "2");
+
+  document.documentElement.removeAttribute("class");
+}
+
+window.addEventListener("MozReftestInvalidate", doTest, false);
+</script>
+
+</body>
+</html>
diff --git a/layout/reftests/mathml/reftest.list b/layout/reftests/mathml/reftest.list
--- a/layout/reftests/mathml/reftest.list
+++ b/layout/reftests/mathml/reftest.list
@@ -92,9 +92,10 @@ fails == mstyle-5.xhtml mstyle-5-ref.xht
 == munder-mover-align-accent-true.html munder-mover-align-accent-true-ref.html
 == munder-mover-align-accent-false.html munder-mover-align-accent-false-ref.html
 == mfrac-linethickness-1.xhtml mfrac-linethickness-1-ref.xhtml
 == mathml-negativespace.html mathml-negativespace-ref.html
 != link-1.xhtml link-ref.xhtml
 == munderover-empty-scripts.html munderover-empty-scripts-ref.html
 == positive-namedspace.html positive-namedspace-ref.html
 == mtable-width.html mtable-width-ref.html
-== maction-selection.html maction-selection-ref.html
\ No newline at end of file
+== maction-selection.html maction-selection-ref.html
+== maction-dynamic-embellished-op.html maction-dynamic-embellished-op-ref.html
