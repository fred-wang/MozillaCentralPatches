# HG changeset patch
# Parent e99d30fc9344dd042e3284a2367e11b2c51adaba
# User Frédéric Wang <fred.wang@free.fr>
Part 6 - Reftests. r=karl, b=961365

diff --git a/layout/reftests/fonts/math/generate.py b/layout/reftests/fonts/math/generate.py
--- a/layout/reftests/fonts/math/generate.py
+++ b/layout/reftests/fonts/math/generate.py
@@ -51,16 +51,25 @@ def saveMathFont(aFont):
     aFont.os2_typodescent = aFont.os2_windescent = em/2
     aFont.hhea_ascent_add = aFont.hhea_descent_add = 0
     aFont.os2_typoascent_add = aFont.os2_typodescent_add = 0
     aFont.os2_winascent_add = aFont.os2_windescent_add = 0
     aFont.os2_use_typo_metrics = True
     aFont.generate(aFont.fontname + ".otf")
     print(" done.")
 
+def createSquareGlyph(aFont, aCodePoint):
+    g = aFont.createChar(aCodePoint)
+    p = g.glyphPen()
+    p.moveTo(0, 0)
+    p.lineTo(em, 0)
+    p.lineTo(em, em)
+    p.lineTo(0, em)
+    p.closePath();
+
 ################################################################################
 # Glyph variants and constructions
 f = newMathFont("stretchy")
 nvariants = 3
 
 # Draw boxes for the size variants and glues
 for i in range(0, nvariants):
     s = em * (i + 1)
@@ -224,8 +233,267 @@ for i in [1, 2, 7, 8, 9]:
     p.lineTo(s, 0)
     p.closePath();
     g.width = s
 
 f[largeop[0]].verticalVariants = "uni2A1B L7 L8 L9"
 f[largeop[1]].verticalVariants = "uni2A1C L8"
 
 saveMathFont(f)
+
+################################################################################
+# Testing AxisHeight
+f = newMathFont("axis-height-1")
+f.math.AxisHeight = 0
+createSquareGlyph(f, ord("+"))
+saveMathFont(f)
+
+f = newMathFont("axis-height-2")
+f.math.AxisHeight = 20 * em
+createSquareGlyph(f, ord("+"))
+saveMathFont(f)
+
+################################################################################
+# Testing Fraction Parameters
+f = newMathFont("fraction-1")
+f.math.FractionRuleThickness = 20 * em
+f.math.FractionNumeratorShiftUp = 0
+f.math.FractionNumeratorDisplayStyleShiftUp = 0
+f.math.FractionDenominatorShiftDown = 0
+f.math.FractionNumeratorGapMin = 0
+f.math.FractionDenominatorGapMin = 0
+f.math.FractionNumeratorDisplayStyleShiftUp = 0
+f.math.FractionDenominatorDisplayStyleShiftDown = 0
+f.math.FractionNumeratorDisplayStyleGapMin = 0
+f.math.FractionDenominatorDisplayStyleGapMin = 0
+saveMathFont(f)
+
+f = newMathFont("fraction-2")
+f.math.FractionRuleThickness = 1 * em
+f.math.FractionNumeratorShiftUp = 0
+f.math.FractionDenominatorShiftDown = 0
+f.math.FractionNumeratorGapMin = 9.5 * em
+f.math.FractionDenominatorGapMin = 0
+saveMathFont(f)
+
+f = newMathFont("fraction-3")
+f.math.FractionRuleThickness = 1 * em
+f.math.FractionNumeratorShiftUp = 0
+f.math.FractionDenominatorShiftDown = 0
+f.math.FractionNumeratorGapMin = 0
+f.math.FractionDenominatorGapMin = 9.5 * em
+saveMathFont(f)
+
+f = newMathFont("fraction-4")
+f.math.FractionRuleThickness = 1 * em
+f.math.FractionNumeratorShiftUp = 3 * em
+f.math.FractionDenominatorShiftDown = 0
+f.math.FractionNumeratorGapMin = 0
+f.math.FractionDenominatorGapMin = 0
+saveMathFont(f)
+
+f = newMathFont("fraction-5")
+f.math.FractionRuleThickness = 1 * em
+f.math.FractionNumeratorShiftUp = 0
+f.math.FractionDenominatorShiftDown = 3 * em
+f.math.FractionNumeratorGapMin = 0
+f.math.FractionDenominatorGapMin = 0
+saveMathFont(f)
+
+f = newMathFont("fraction-6")
+f.math.FractionRuleThickness = 1 * em
+f.math.FractionNumeratorDisplayStyleShiftUp = 0
+f.math.FractionDenominatorDisplayStyleShiftDown = 0
+f.math.FractionNumeratorDisplayStyleGapMin = 9.5 * em
+f.math.FractionDenominatorDisplayStyleGapMin = 0
+saveMathFont(f)
+
+f = newMathFont("fraction-7")
+f.math.FractionRuleThickness = 1 * em
+f.math.FractionNumeratorDisplayStyleShiftUp = 0
+f.math.FractionDenominatorDisplayStyleShiftDown = 0
+f.math.FractionNumeratorDisplayStyleGapMin = 0
+f.math.FractionDenominatorDisplayStyleGapMin = 9.5 * em
+saveMathFont(f)
+
+f = newMathFont("fraction-8")
+f.math.FractionRuleThickness = 1 * em
+f.math.FractionNumeratorDisplayStyleShiftUp = 3 * em
+f.math.FractionDenominatorDisplayStyleShiftDown = 0
+f.math.FractionNumeratorDisplayStyleGapMin = 0
+f.math.FractionDenominatorDisplayStyleGapMin = 0
+saveMathFont(f)
+
+f = newMathFont("fraction-9")
+f.math.FractionRuleThickness = 1 * em
+f.math.FractionNumeratorDisplayStyleShiftUp = 0
+f.math.FractionDenominatorDisplayStyleShiftDown = 3 * em
+f.math.FractionNumeratorDisplayStyleGapMin = 0
+f.math.FractionDenominatorDisplayStyleGapMin = 0
+saveMathFont(f)
+
+################################################################################
+# Testing Stack Parameters
+f = newMathFont("stack-1")
+f.math.StackTopShiftUp = 0
+f.math.StackBottomShiftDown = 0
+f.math.StackGapMin = 20 * em
+saveMathFont(f)
+
+f = newMathFont("stack-2")
+f.math.StackTopShiftUp = 3 * em
+f.math.StackBottomShiftDown = 0
+f.math.StackGapMin = 0
+saveMathFont(f)
+
+f = newMathFont("stack-3")
+f.math.StackTopShiftUp = 0
+f.math.StackBottomShiftDown = 3 * em
+f.math.StackGapMin = 0
+saveMathFont(f)
+
+f = newMathFont("stack-4")
+f.math.StackTopDisplayStyleShiftUp = 0
+f.math.StackBottomDisplayStyleShiftDown = 0
+f.math.StackDisplayStyleGapMin = 20 * em
+saveMathFont(f)
+
+f = newMathFont("stack-5")
+f.math.StackTopDisplayStyleShiftUp = 3 * em
+f.math.StackBottomDisplayStyleShiftDown = 0
+f.math.StackDisplayStyleGapMin = 0
+saveMathFont(f)
+
+f = newMathFont("stack-6")
+f.math.StackTopDisplayStyleShiftUp = 0
+f.math.StackBottomDisplayStyleShiftDown = 3 * em
+f.math.StackDisplayStyleGapMin = 0
+saveMathFont(f)
+
+################################################################################
+# Testing Radical Parameters
+f = newMathFont("radical-1")
+f.math.RadicalExtraAscender = 0
+f.math.RadicalRuleThickness = 5 * em
+f.math.RadicalVerticalGap = 0
+createSquareGlyph(f, 0x221a)
+saveMathFont(f)
+
+f = newMathFont("radical-2")
+f.math.RadicalExtraAscender = 7 * em
+f.math.RadicalRuleThickness = 1 * em
+f.math.RadicalVerticalGap = 0
+createSquareGlyph(f, 0x221a)
+saveMathFont(f)
+
+f = newMathFont("radical-3")
+f.math.RadicalExtraAscender = 0
+f.math.RadicalRuleThickness = 1 * em
+f.math.RadicalVerticalGap = 3 * em
+createSquareGlyph(f, 0x221a)
+saveMathFont(f)
+
+f = newMathFont("radical-4")
+f.math.RadicalExtraAscender = 0
+f.math.RadicalRuleThickness = 1 * em
+f.math.RadicalDisplayStyleVerticalGap = 9 * em
+createSquareGlyph(f, 0x221a)
+saveMathFont(f)
+
+f = newMathFont("radical-5")
+f.math.RadicalExtraAscender = 0
+f.math.RadicalRuleThickness = 1 * em
+f.math.RadicalVerticalGap = 0
+f.math.RadicalDegreeBottomRaisePercent = 25
+createSquareGlyph(f, 0x221a)
+saveMathFont(f)
+
+f = newMathFont("radical-6")
+f.math.RadicalKernBeforeDegree = 5 * em
+f.math.RadicalKernAfterDegree = 0
+createSquareGlyph(f, 0x221a)
+saveMathFont(f)
+
+f = newMathFont("radical-7")
+f.math.RadicalKernBeforeDegree = 0
+f.math.RadicalKernAfterDegree = 7 * em
+createSquareGlyph(f, 0x221a)
+saveMathFont(f)
+
+################################################################################
+# Testing Scripts Parameters
+f = newMathFont("scripts-1")
+f.math.SpaceAfterScript = 3 * em
+saveMathFont(f)
+
+f = newMathFont("scripts-2")
+f.math.SuperscriptShiftUp = 7 * em
+saveMathFont(f)
+
+f = newMathFont("scripts-3")
+f.math.SuperscriptShiftUpCramped = 5 * em
+createSquareGlyph(f, 0x221a)
+saveMathFont(f)
+
+f = newMathFont("scripts-4")
+f.math.SubscriptShiftDown = 6 * em
+saveMathFont(f)
+
+f = newMathFont("scripts-5")
+f.math.SubSuperscriptGapMin = 11 * em
+saveMathFont(f)
+
+f = newMathFont("scripts-6")
+f.math.SubSuperscriptGapMin = 11 * em
+f.math.SuperscriptBottomMaxWithSubscript = 3 * em
+saveMathFont(f)
+
+f = newMathFont("scripts-7")
+f.math.SubscriptTopMax = 5 * em
+saveMathFont(f)
+
+f = newMathFont("scripts-8")
+f.math.SuperscriptBottomMin = 9 * em
+saveMathFont(f)
+
+################################################################################
+# Testing Limits Parameters
+f = newMathFont("limits-1")
+f.math.UpperLimitGapMin = 7 * em
+f.math.UpperLimitBaselineRiseMin = 0
+f.math.LowerLimitGapMin = 0
+f.math.LowerLimitBaselineDropMin = 0
+createSquareGlyph(f, 0x2211)
+saveMathFont(f)
+
+f = newMathFont("limits-2")
+f.math.UpperLimitGapMin = 0
+f.math.UpperLimitBaselineRiseMin = 0
+f.math.LowerLimitGapMin = 5 * em
+f.math.LowerLimitBaselineDropMin = 0
+createSquareGlyph(f, 0x2211)
+saveMathFont(f)
+
+f = newMathFont("limits-3")
+f.math.UpperLimitGapMin = 0
+f.math.UpperLimitBaselineRiseMin = 9 * em
+f.math.LowerLimitGapMin = 0
+f.math.LowerLimitBaselineDropMin = 0
+createSquareGlyph(f, 0x2211)
+saveMathFont(f)
+
+f = newMathFont("limits-4")
+f.math.UpperLimitGapMin = 0
+f.math.UpperLimitBaselineRiseMin = 0
+f.math.LowerLimitGapMin = 0
+f.math.LowerLimitBaselineDropMin = 2 * em
+createSquareGlyph(f, 0x2211)
+saveMathFont(f)
+
+f = newMathFont("limits-5")
+f.math.UpperLimitGapMin = 0
+f.math.UpperLimitBaselineRiseMin = 0
+f.math.LowerLimitGapMin = 0
+f.math.LowerLimitBaselineDropMin = 0
+f.math.AccentBaseHeight = 6 * em
+f.math.FlattenedAccentBaseHeight = 3 * em
+createSquareGlyph(f, ord("~"))
+saveMathFont(f)
diff --git a/layout/reftests/fonts/math/stretchy.otf b/layout/reftests/fonts/math/stretchy.otf
index f192de346316ee35c7da99356a83361b28ed7b61..3ce7766433a26e3a2ae361e561431f7f619cb12b
GIT binary patch
literal 3236
zc%0o<Yitx%6h3Eny4%OFT?&*ULo+Q%%B$U79)$`<C@g|4#nAAB5MbL5Y)QAfZnxzT
zV=6U4Srw$dz>3&FB!=~$H5#q{0D=jx5RE@1D2WL%gb>rxEnDpR-I>{K3lTB?b9V21
z=Y01&=bo9l_s-PR*49uCwUd=xm0qt}c6HzfqKvsj(qyl<wt8paPBT%~N+MFKm)Aaf
zXXBLH@V60JuGDNO^W=?R+DgPK`nS~we4)y=nrlSXQ{d|Sny+Ezs!vy=?`yP0eh_nN
zXC`3xqs{OKBD)<6V3F*?DH8DQ4$-vrFu4FHTeB~qEiV5u48I-Ym4t#Vkz@zWM}0E-
zRbn9}(!Q^lv^96>UCNO}GP+zavt|VQdP)XL2H<9rg^U9+7U66zxl1&36TM7hk7-2f
z^)pG99PXzKL>#ePfPc_HzD4snOXRUx(@`SJwlR6WBXzc7jAb!~9~ntCufRc{rP-OZ
z&a@fz?l)}=LdQ(oO4I4KX-kyJ(@i^roScfafqwx?mQW#8=~2RFa#E{lTS%rurfnrJ
zoiuF;dB&S|2B|#Pv~A$GQY8f`M0+SqjkJUO6u~u=P(958ddNj?S^%pWs=ZJ&;pc-d
zqQZz1XCGo3VPRHP219$ojXV4iwWNNQ>T$UjsMW!}jZIBHwK5nE1;f5bV-UI)goH`M
zxgJCA0TBsnk$OL@YS0bH*Gd66T0>(i(5t79=om(snqFKf%2TNV?ZJEoyO8EVH7|V`
z<PA1Qyut7eP4$$z)Cx5<D$IrRJo7}okF0GY=r9Dv)v8D<5|`>IN}-KfxCIxex?Jv3
zm&>I-GMjjYMpMkEyjeUM-IwSYv552;E|FT)U39YO)NCc06tk?T3*INQrzVrh8`rmA
zZ@6Cn;~x*scec?(OW?udpZfm?hq;oI?P8C4_+XMGV&<&$Q(+6pn!#KeT*QOrmchl=
z!O2qL4a<q7Y%P4gJ1I+r*_73`u`C)*8?rsB^z|qu1NdhstmP_1PKA$+S4dT?H}j~_
zqA&hj%EtyYgXUmHF2Mt?q7AeO4}A-^m^w`Q?X(jUs|B;<MQq>u=oM@iG5VaoX>D%w
zxR+EKu+o5426%N??lQn_fX9G^29*24;oz>;P(yQFizcY$?iB`9`dw`<zq`%t_q2JM
zwCxdn?fL_a4RygtBp8SULv3)X7F8{-a=RXHai{L&=y}e(pI_zI_y9-wb$)~2<b!;O
z-{QmE$#3&J{4T%8@ADBp${%nSf5^x9BR<X_(=>74p2T)kfqUh{cJnfI(h2IJGjx@%
z({D7u7FM{Jm+)%d!Vx4p#ozMJe2a%HIZC1;+8gia<=)=-`Ce;p{$OeR_xq)`-l3jJ
z@s9ZUp$@xac!fh5>@JRL9PP6fOMP)|y3L`xaSeW4i)%xg&7s_j7~~~EUIKZ^=7{#`
zs;C}ihvu5l6ib8UaqWIN`pq;^GYupOuPHeW$#EgMl#=L4?GD2;QlvdyEsBjwiC7{w
z9J4zHqLP{|m_*Dv90RRndWK^*!3*21Yla2OQMf__fUCqW+stT1>M#_dQ(h}N`+D?F
z-E+gU3lTyDlQ<nUB#F}*Myz0m!8+@}4hz<KF~utKnpD6SiPNe6%&t^&yD@;l?PAba
zLMAP*)dv7d%FU(`7KIpn&Wq3&bc+AY0BS54hOeF#|6iVhUsMKPUysU9*>*>~VWMI`
zHz_J-$F=Of{(f0b#BzZ5TI6w9qZ7myAnUisjUntg#@2x2!m{qm0>^xRh@Ncvl}qtK
zvD8ND*?+YoT{Lm_V`z_}jO~x1n{Q}!OxdGyjN#{xYNO&Ad)A*{!Cr=qDjzrlnEGyE
zeft{i%|MeWj|!;pZ>utt6Zs`RjA$Fagi7gYyu#PvJ-P`S-cGz2_t615tk-3zL)fu%
zr6*{7riUiT&*{AI1qx1};M>g+rmE-0p!jtmhXXNA==01R4l{?-%pv&GW}O){S%AD2
zrwOLTG(}hionyFywC=yfO-%cFX-$4QZiJikpW}?@mO*yP!ko>)GaCorhGxNClEinV
u_=c54g?_Xv2&pi!+dzwKV5$jirh5caO<psCqKTTEbw*41>KP*Oh5i?IBuXX#

diff --git a/layout/reftests/mathml/reftest.list b/layout/reftests/mathml/reftest.list
--- a/layout/reftests/mathml/reftest.list
+++ b/layout/reftests/mathml/reftest.list
@@ -149,16 +149,22 @@ skip-if(B2G) == maction-dynamic-1.html m
 == mo-invisibleoperators-2.html mo-invisibleoperators-2-ref.html
 skip-if(B2G) == maction-dynamic-3.html maction-dynamic-3-ref.html # bug 773482
 == whitespace-trim-1.html whitespace-trim-1-ref.html
 == whitespace-trim-2.html whitespace-trim-2-ref.html
 == whitespace-trim-3.html whitespace-trim-3-ref.html
 fails == whitespace-trim-4.html whitespace-trim-4-ref.html # Bug 787215
 == whitespace-trim-5.html whitespace-trim-5-ref.html
 random-if(winWidget&&!d2d) == opentype-stretchy.html opentype-stretchy-ref.html
+== opentype-axis-height.html data:text/html,<body>Pass
+== opentype-radical.html data:text/html,<body>Pass
+== opentype-fraction.html data:text/html,<body>Pass
+== opentype-stack.html data:text/html,<body>Pass
+== opentype-scripts.html data:text/html,<body>Pass
+== opentype-limits.html data:text/html,<body>Pass
 == operator-1.xhtml operator-1-ref.xhtml
 == scriptshift-1.xhtml scriptshift-1-ref.xhtml
 == number-size-1.xhtml number-size-1-ref.xhtml
 random-if(B2G&&browserIsRemote) == multiscripts-1.html multiscripts-1-ref.html # B2G - slight height variation from font metrics
 == mathml-mmultiscript-base.html mathml-mmultiscript-base-ref.html
 == mathml-mmultiscript-mprescript.html mathml-mmultiscript-mprescript-ref.html
 != menclose-1a.html menclose-1-ref.html
 != menclose-1b.html menclose-1-ref.html
