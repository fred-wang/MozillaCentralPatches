# HG changeset patch
# User Frédéric Wang <fred.wang@free.fr>
# Date 1267025933 -3600
# Node ID cc219cd44fdbe2adbe0f0a22c1e790f724149a87
# Parent e34da72edb74e1344fd09c8052bede7b6819e734
imported patch workaround_bars.diff

diff --git a/layout/mathml/nsMathMLFrame.cpp b/layout/mathml/nsMathMLFrame.cpp
--- a/layout/mathml/nsMathMLFrame.cpp
+++ b/layout/mathml/nsMathMLFrame.cpp
@@ -336,17 +336,17 @@ nsMathMLFrame::GetRuleThickness(nsIRende
   nscoord xHeight;
   aFontMetrics->GetXHeight(xHeight);
   PRUnichar overBar = 0x00AF;
   nsBoundingMetrics bm;
   nsresult rv = aRenderingContext.GetBoundingMetrics(&overBar, PRUint32(1), bm);
   if (NS_SUCCEEDED(rv)) {
     aRuleThickness = bm.ascent + bm.descent;
   }
-  if (NS_FAILED(rv) || aRuleThickness <= 0 || aRuleThickness >= xHeight) {
+  if (NS_FAILED(rv) || aRuleThickness <= 0 || aRuleThickness >= xHeight/3) {
     // fall-back to the other version
     GetRuleThickness(aFontMetrics, aRuleThickness);
   }
 
 #if 0
   nscoord oldRuleThickness;
   GetRuleThickness(aFontMetrics, oldRuleThickness);
 
