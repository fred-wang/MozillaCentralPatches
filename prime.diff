# HG changeset patch
# Parent c93cfe704487cf493fc4f289e015f068e49c4644
# User James Kitchener <jkitch.bug@gmail.com>
Bug 442637 - MathML changes to use font feature ssty for sub/supscripts

diff --git a/layout/mathml/mathml.css b/layout/mathml/mathml.css
--- a/layout/mathml/mathml.css
+++ b/layout/mathml/mathml.css
@@ -320,9 +320,10 @@ mtd[_moz-math-columnline="dashed"] {
 
 /* all other cases can be described using regular CSS, so we do it this way because it's
    more efficient and less code */
 mroot > :not(:first-child) { -moz-script-level:+2; }
 
 msub > :not(:first-child),
 msup > :not(:first-child),
 msubsup > :not(:first-child),
-mmultiscripts > :not(:first-child) { -moz-script-level:+1; }
+mmultiscripts > :not(:first-child) { -moz-script-level:+1;
+                                     -moz-font-feature-settings: 'ssty'; }
diff --git a/layout/reftests/mathml/reftest.list b/layout/reftests/mathml/reftest.list
--- a/layout/reftests/mathml/reftest.list
+++ b/layout/reftests/mathml/reftest.list
@@ -125,16 +125,17 @@ fails == whitespace-trim-4.html whitespa
 == whitespace-trim-5.html whitespace-trim-5-ref.html
 == operator-1.xhtml operator-1-ref.xhtml
 == scriptshift-1.xhtml scriptshift-1-ref.xhtml
 == number-size-1.xhtml number-size-1-ref.xhtml
 == multiscripts-1.html multiscripts-1-ref.html
 == mathml-mmultiscript-base.html mathml-mmultiscript-base-ref.html
 == mathml-mmultiscript-mprescript.html mathml-mmultiscript-mprescript-ref.html
 != menclose-1.html menclose-1-ref.html
+== ssty.html ssty-ref.html
 == mathvariant-1a.html mathvariant-1a-ref.html
 == mathvariant-1b.html mathvariant-1b-ref.html
 == mathvariant-1c.html mathvariant-1c-ref.html
 == mathvariant-1d.html mathvariant-1d-ref.html
 == mathvariant-2.html mathvariant-2-ref.html
 == mathvariant-3.html mathvariant-3-ref.html
 == mathvariant-4.html mathvariant-4-ref.html
 == mathvariant-5.html mathvariant-5-ref.html
diff --git a/layout/reftests/mathml/ssty-ref.html b/layout/reftests/mathml/ssty-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/mathml/ssty-ref.html
@@ -0,0 +1,21 @@
+<!doctype html>
+<head>
+  <style type="text/css" media="screen, print">
+    @font-face {
+      font-family: "ssty";
+      src: url("ssty.woff");
+    }
+  </style>
+</head>
+<body>
+  <math>
+    <mstyle style="font-family: 'ssty'">
+      <msup>
+        <mo>A</mo>
+        <msup>
+          <mo>B</mo>
+          <mo>C</mo>
+        </msup>
+      </msup>
+    </mstyle>
+</body>
diff --git a/layout/reftests/mathml/ssty.html b/layout/reftests/mathml/ssty.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/mathml/ssty.html
@@ -0,0 +1,21 @@
+<!doctype html>
+<head>
+  <style type="text/css" media="screen, print">
+    @font-face {
+      font-family: "ssty";
+      src: url("ssty.woff");
+    }
+  </style>
+</head>
+<body>
+  <math>
+    <mstyle style="font-family: 'ssty';">
+      <msup>
+        <mo>A</mo>
+        <msup>
+          <mo>A</mo>
+          <mo>A</mo>
+        </msup>
+      </msup>
+    </mstyle>
+</body>
diff --git a/layout/reftests/mathml/ssty.woff b/layout/reftests/mathml/ssty.woff
new file mode 100644
index 0000000000000000000000000000000000000000..386c4de5e55fb84f49f82a4424df4515bbe13ca5
GIT binary patch
literal 1368
zc${ri3rv$&7`<)j&#MX!6mSkpBuoLJ(#b=SR*OZuA}lSTGGTwAR762Q2HjxLj)z!f
zmZ}r63Uk2;$Ye4_Hla@tXe%#uxS;}5SP-XJH&MWUw<R$#*-cJv&bi+`U+$Nan;XSs
zMsc}O01$a#5rE4&AK<|ME(ViH1^`Ea2!IF~qMd%qWO5?`zzg8<3N!ZPlm|tGZ)HMF
z47n?WJ8%H*5z$c`s8vGl3qiStU3(M3iP-`*9ptbcB&@yWTNcIfhu#Dd<SYo3M@-Zv
zrSUVM#)CWz_T7Sa#80Lq^I=bd*$>u(Kuo{Sm;yzp87w^k@I?Hq@>0^WMNpf9-0VrR
zSpxdg_#(644CIIfR?#4xpOy@O6{NT@^LwUR!@V;0AIOGtp+j*Q1Q{y@RFNV{fb#jM
zK=9Dc=+o`ny*+ZB02L&ng1%XG?=wc#^g+^~!_M)QW4@b0kL+%5nA`P&S`|~u_fnDw
zMPiZ`zu655b7Q7?AVQft2ib_^PMo`?lizYKd2W!Ch%Iy1-)osW_kv4YwTVD1KO&do
zeZHFis3v9kHtwb1NPqt;;ZEs6nkDoaU5%keqtbL;5S+X>(Dw4+<Alz(yu$Rm`s=Y%
zCv`_pV4g$&zFFfkKl=KBer0S<JH~FbkLz*6sK=|$faa~r-q#!x<H<oMp9jY<_KmX>
zWjSxgz31aiXC{8Vo!fBgX=Gu;7aK6Fx>Gf?seblRVW|<rb{AIP=y`c>l*Z|3CVlc4
z!*m!nJB@xhS=hOe#J-rXOb!2Kt9}A|ct(B4s3n3EGEt-@I+jEkT(XkP`^`(GXBYP4
z>)||6ff$4#>&V@B9h+{jQ3Jwfz|W$i=tyE8zb^^R$~4*XNA%l$yOU%nijz|3Fb7XZ
zUzo<TJ=S~Q)>6=>cWV<DYI}h^LP%Zaa*`X6A?Be5jf!+WL|o~>rs6!PGGZ}ct+hP{
zfZ2y%pq?p_oRCQB4(|yf5Eu@{!t1?gSC^G@GWw@LjAJ66j<WG8O@>%qp+2>9R7qqw
z5B`J^ZPv4wlI-YRHsF$Ek!ZmSMTKJ24PhdVO}OW->ilI0k!-{lliN)gMjx2QFwDBf
z+s*Z^E6RS3TjfNpWs*DrC{iG^3-{rhz?i*%YEFmgkNo5jVFAvWAKX$P{ZNr3s8kvB
z*`%&VD2hLX2bpC1CvWd;=%h$Iq_2nsM~W$c5>SKp0<6RM%P{eOS@1d740Zt!ZHc=`
zQ6i)5&{AAGs%N95#g3D<q2C4Qu5e1d_tsukZF4!#%3S`voLkr6F7au~#OX8!+o9kk
z{&g|79{s#m?bX#ZWhhY<a^E9E^y9QEkF1FpS&Yos4R_SaBza{z#z>f-?!XA{pP(Jm
z1YLap{Zt-W_M7Sh#V9qyrDbOEur_+w>TibK`y%>0k$S6%r)d_-hO`y-11pxYvIh5F
z6!}%qH#Z**9&HWWwr;#fyRSeIGnDnig}BLB)y1nH@29rrw#!WQFHH3bJ5Q}%8&UG|
zbav>?y7BV*tF7LR6OFTXt{(b1ov@r$n_G}Z9gA-WnR=!xHx7R@uN+?UK>4lpJycqG
zyU9xtSlKrf+sAdM?FbwkstoQIW_eG19cNrQ_Irwayu2+n&&l5Y)BW)=tj6+zIK5LT
djY>;yTbQ{J6k$dZlP;~m!5?&W46YS`{{U@YA7cOj

